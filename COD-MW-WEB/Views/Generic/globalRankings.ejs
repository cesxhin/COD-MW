<!DOCTYPE html>
<html lang="it-IT">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/Public/style.css">
    <title>Classifica Globale</title>
</head>
<body>
    <div class="form-insert">
        <form action="/globalRankings" method="post">
            <% if(!rankings) { %> 
                <a href="/home">Torna indietro</a>
    
                <label for="tournamentDate">Data Torneo</label>
               <input type="date" name="tournamentDate" required>
        
                <input type="submit" value="Vedi classifica">
            <% } else { %>
                <div class="table-management">
                    <table>
                        <tr>
                            <th>ID Torneo</th>
                            <th>Data Inizio</th>
                            <th>Ora Inizio</th>
                            <th>Ora Fine</th>
                        </tr>
                        <tr>
                            <td><%= rankings.id %></td>
                            <td><%= new Date(rankings.start_date).toLocaleDateString('it-IT') %></td>
                            <td><%= rankings.start_time %></td>
                            <td><%= rankings.end_time %></td>
                        </tr>
                    </table>
                        
                        <br>
                    <table>
                        <% rankings.teams.teams.forEach(t => { %>
                            <tr>
                                <th><%= t.tournamentPlace %></th>  
                                <th colspan="2"style="background-color : chartreuse"><%= t.teamName %></th>
                                <th style="background-color: sandybrown;">1° PARTITA</th>
                                <th style="background-color: skyblue;">2° PARTITA</th>
                                <th style="background-color: tomato;">3° PARTITA</th>
                                <th style="background-color: darksalmon;">TOT : </th>
                            </tr>
                            <tr>
                                <th colspan="3" >Posizione : </th>
                                <td style="background-color: sandybrown;"><%= t.matches[0].teamPlacement %></td>
                                <td style="background-color: skyblue;"><%= t.matches[1].teamPlacement %></td>
                                <td style="background-color: tomato;"><%= t.matches[2].teamPlacement %></td>
                                <td style="background-color: darksalmon;"></td>
                            </tr>
                            <tr>
                                <% let bonusPoints = t.matches[0].bonus + t.matches[1].bonus + t.matches[2].bonus; %>
                                <th colspan="3">Punteggio bonus: </th>
                                <td><%= t.matches[0].bonus %></td>
                                <td><%= t.matches[1].bonus %></td>
                                <td><%= t.matches[2].bonus %></td>
                                <td><%= bonusPoints %></td>
                            </tr>
                            <% const m = t.matches;    
                                for(let i = 0; i < m.length; i++) {
                                    for(let k = 0 ; k < m[i].players.length; k++){ 
                                        let totalPointsMatch = 0; %>
                                        <tr>
                                            <th><%= m[i].players[k].username %></th>
                                            <td colspan="2">KILL : </td> 
                                            <% let index = i; 
                                            while(index < m.length) { %>
                                                <td><%= m[index].players[k].kills %></td>
                                                <% totalPointsMatch += m[index].players[k].kills;
                                                index++; 
                                            } %>
                                            <td><%= totalPointsMatch %></td>
                                        </tr>
                                        
                                    <%}
                                    break;
                                }
                                %>
                                <tr>
                                    <th colspan="" style="background-color : red">TOTALE PUNTI TEAM : </th>
                                    <td style="background-color: darksalmon;"><%= t.totalPoints %></td>
                                </tr>
                                <!-- ma fra dov'è tag punteggio? , cosa intendi  Punteggio  fermo , c'è gia posizione, fermo un attimo che vedo un a cosa :-->
                            <% }); %> 
                    </table>
                       
                    
                </div>
                <a class="button-link" href="/home">Torna indietro</a> 
            <% } %>
        </form>
    </div>
    
</body>
</html>